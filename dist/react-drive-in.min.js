/*
 * React Video - React component supporting background videos and playlists.
 * @version v1.0.1
 * @link https://github.com/ronik-design/react-drive-in
 * @license ISC
 * @author Ronik Design (http://www.ronikdesign.com)
*/
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("react")):"function"==typeof define&&define.amd?define(["react"],e):"object"==typeof exports?exports.ReactDriveIn=e(require("react")):t.ReactDriveIn=e(t.React)}(this,function(t){return function(t){function e(s){if(i[s])return i[s].exports;var o=i[s]={exports:{},id:s,loaded:!1};return t[s].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){var s=i(1),o=i(2);t.exports=s.createClass({displayName:"DriveIn",propTypes:{show:s.PropTypes.oneOfType([s.PropTypes.string,s.PropTypes.array]),showPlaylist:s.PropTypes.oneOfType([s.PropTypes.array]),poster:s.PropTypes.string,duration:s.PropTypes.number,mute:s.PropTypes.bool,loop:s.PropTypes.bool,slideshow:s.PropTypes.bool,onPlaying:s.PropTypes.func,onPause:s.PropTypes.func,onTime:s.PropTypes.func,onTimeFrequency:s.PropTypes.number,onCanPlay:s.PropTypes.func},getDefaultProps:function(){return{className:"drive-in",duration:"auto",mute:!0,loop:!0,slideshow:!1,volume:.5,onTimeFrequency:500}},getInitialState:function(){return{playlist:null,initialized:!1,playing:!1,mute:!0,currentItem:0}},getMedia:function(){return this.refs.media.getDOMNode()},getPlaylist:function(){return this.state.playlist},setPlaying:function(t){this.setState({playing:!0,currentItem:t}),this.props.onPlaying&&this.props.onPlaying(t)},setPause:function(){this.setState({playing:!1}),this.props.onPause&&this.props.onPause()},setLoading:function(){this.setState({canPlay:!1})},setCanPlay:function(){this.setState({canPlay:!0}),this.props.onCanPlay&&this.props.onCanPlay()},componentWillMount:function(){this.DI=new o},componentDidMount:function(){var t,e,i=this.DI;i.init({el:this.getMedia(),slideshow:this.props.slideshow}),t={mute:this.props.mute,duration:this.props.duration,loop:this.props.loop,poster:this.props.poster},e=this.props.showPlaylist?i.showPlaylist(this.props.showPlaylist,t):i.show(this.props.show,t),i.on("media.playing",function(t){this.setPlaying(t)}.bind(this)),i.on("media.pause",function(){this.setPause()}.bind(this)),i.on("media.loading",function(){this.setLoading()}.bind(this)),i.on("media.canplay",function(){this.setCanPlay()}.bind(this)),this.props.onTime&&(this.intervalId=window.setInterval(function(){var t=i.currentTime();this.props.onTime(t)}.bind(this),this.props.onTimeFrequency)),this.setState({mute:this.props.mute,playlist:e,initalized:!0})},componentWillUnmount:function(){this.intervalId&&window.clearInterval(this.intervalId),this.DI.removeAllListeners(),this.DI.close(),delete this.DI},play:function(t){this.DI.play(t)},pause:function(){this.DI.pause()},mute:function(){this.DI.setVolume(0),this.state.mute=!0},unmute:function(){this.DI.setVolume(this.props.volume),this.state.mute=!1},seekTo:function(t){this.DI.seekTo(t)},duration:function(){return this.DI.duration()},render:function(){return s.DOM.div({ref:"wrap",id:"drive-in-wrap",className:this.props.className},s.DOM.div({ref:"media",className:"drive-in-media"}))}})},function(e){e.exports=t},function(t,e,i){t.exports=i(3)},function(t,e,i){function s(){return self.innerHeight?self.innerWidth:document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientWidth:document.body?document.body.clientWidth:void 0}function o(){return self.innerHeight?self.innerHeight:document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientHeight:document.body?document.body.clientHeight:void 0}function n(t,e){var i="";for(var s in e)i+=s+":"+e[s]+";";t.style.cssText+=";"+i}function r(t){var e={},i={mp4:!0,ogv:!0,webm:!0},s={jpg:!0,png:!0,gif:!0},o=t.replace(/[\?|\#].+/,"").match(/\.([mp4|ogv|webm|jpg|jpeg|png|gif]+)$/)[1];return i[o]&&(e.type="ogv"===o?"video/ogg":"video/"+o),s[o]&&(e.type="jpg"===o?"image/jpeg":"image/"+o),e.src=t,e}function a(t,e){e=e||0;var i,s=[];for(var o in t)i=t[o],i.constructor===Object&&s.push([i]),i.constructor===Array&&s.push(a(i,e+1)),"string"==typeof i&&s.push(0===e?[r(i)]:r(i));return s}function p(t){var e,i;for(var s in t){if(i=t[s],i.constructor===Array)e=p(i);else if(i.type.search(/^image/)>-1)return i;if(e)return e}}function l(t,e){var i=document.createElement(t);for(var s in e)i[s]=e[s];return i}function h(t,e){var i,s,o=this,n=e;this.pause=function(t){window.clearTimeout(i),n-=new Date-s,t||this.emit("pause")},this.resume=function(e){s=new Date,window.clearTimeout(i),i=window.setTimeout(t,n),e||this.emit("resume")},this.currentTime=function(){var t=new Date-s;return i&&(this.pause(!0),this.resume(!0)),t},this.destroy=function(){o.pause(!0),o.removeAllListeners()},this.resume()}function u(){this._listeners=[],this.parentEl=null,this.mediaEl=null,this.mute=!0,this.currMediaType=null,this.mediaAspect=16/9,this.playlist=null,this.loop=!0,this.slideshow=!1,this.playlistLength=0,this.currentItem=0,this.slideshowItemDuration=10,this._slideshowTimer=null,this.poster=null}var c=i(4),d=i(5);d(h,c),d(u,c),u.prototype._updateSize=function(){var t=document.body,e=this.parentEl,i=this.mediaEl,r=this.mediaAspect,a=this.currMediaType,p=s(),l=o(),h=t.offsetWidth<p?t.offsetWidth:p,u=t.offsetHeight<l?t.offsetHeight:l,c=h/u;"BODY"===t.nodeName&&(n(t,{height:"auto"}),l>t.offsetHeight&&(n(t,{height:"100%"}),n(document.documentElement,{height:"100%"}))),r>c?"video"==a?(n(e,{width:Math.ceil(u*r)+"px",height:u+1+"px"}),n(i,{width:Math.ceil(u*r)+"px",height:u+"px"})):n(i,{width:"auto",height:u+"px"}):"video"==a?(n(e,{width:h+"px",height:Math.ceil(h/r)+1+"px"}),n(i,{width:e.offsetWidth+"px",height:"auto"})):n(i,{width:h+"px",height:"auto"})},u.prototype._setVideoData=function(){var t=this.mediaEl;this.mediaAspect=t.videoWidth/t.videoHeight,this._updateSize()},u.prototype._setImageData=function(t){this.mediaAspect=t.naturalWidth/t.naturalHeight,this._updateSize()},u.prototype._playVideoItem=function(t,e){var i,s,o,n,r=this.mediaEl;for(var a in t)i=t[a],n=r.canPlayType(i.type),"probably"===n?s=i.src:n&&!s&&(s=i.src),0!==i.type.search(/^image/)||s||(o=i.src);s?(this.mediaEl.src=s,o&&(this.mediaEl.poster=o),this.playlistLength<2&&(this.mediaEl.loop=!0),this.mute&&this.setVolume(0),this.currentItem=e,this.mediaEl.load()):o||this.poster?(this.slideshow=!0,this.createMediaEl(),this._playImageItem(t,e)):this.emit("media.error",new Error("No playable source"))},u.prototype._playImageItem=function(t,e){var i,s;for(var o in t)i=t[o],0!==i.type.search(/^image/)||s||(s=i.src);!s&&this.poster&&(s=this.poster.src),s?(this.mediaEl.src=s,this.currentItem=e):this.emit("media.error",new Error("No playable source"))},u.prototype._playItem=function(t,e){"video"===this.currMediaType&&this._playVideoItem(t,e),"image"===this.currMediaType&&this._playImageItem(t,e)},u.prototype._loadPlaylist=function(t){this.playlist=t,this.playlistLength=t.length,this._playItem(t[0],0)},u.prototype._addListener=function(t,e,i){t.addEventListener(e,i),this._listeners.push({element:t,event:e,handler:i})},u.prototype._removeAllListeners=function(){var t,e=this._listeners;for(var i in e)t=e[i],t.element.removeEventListener(t.event,t.handler)},u.prototype._attachVideoListeners=function(){function t(t){r._setVideoData(t)}function e(){r.emit("media.playing",r.currentItem)}function i(){r.emit("media.pause")}function s(t){var e=0,i=t.target.readyState,s=t.target.networkState,o=t.target.buffered,n=t.target.duration;if(1===s&&0===i&&(e=100),i>0){var a=o.end(0);e=a/n*100}r.emit("media.progress",e)}function o(){if(r.emit("media.loading"),!r._seeking&&(r.emit("media.ended",r.currentItem),r.playlistLength>1&&r.loop)){var t=0;r.currentItem+1<r.playlistLength&&(t=r.currentItem+1),r.play(t)}}function n(){r.emit("media.canplay"),a.play(),r._seeking&&(r._seeking=!1)}var r=this,a=this.mediaEl;this._addListener(a,"loadedmetadata",t),this._addListener(a,"playing",e),this._addListener(a,"pause",i),this._addListener(a,"ended",o),this._addListener(a,"canplay",n),this._addListener(a,"progress",s,!1)},u.prototype._attachImageListeners=function(){function t(){var t=new Event("ended");o.mediaEl.dispatchEvent(t)}function e(){o.emit("media.pause")}function i(){o.emit("media.canplay"),o.playlistLength>1&&(o._slideshowTimer&&o._slideshowTimer.destroy(),o._slideshowTimer=new h(t,1e3*o.slideshowItemDuration),o._slideshowTimer.on("pause",e)),o._setImageData(this),o.emit("media.playing",o.currentItem)}function s(){if(o.emit("media.ended",o.currentItem),o.playlistLength>1&&o.loop){var t=o.currentItem+1<o.playlistLength?o.currentItem+1:0;o.play(t)}}var o=this,n=this.mediaEl;this._addListener(n,"load",i),this._addListener(n,"ended",s)},u.prototype._attachListeners=function(){function t(){window.requestAnimationFrame(e._updateSize.bind(e))}var e=this;this._addListener(window,"resize",t),"video"===this.currMediaType?this._attachVideoListeners():this._attachImageListeners()},u.prototype._setParent=function(t){return this.parentEl=t,n(this.parentEl,{position:"absolute",display:"block",transform:"translate3d(-50%,-50%,0)","-webkit-transform":"translate3d(-50%,-50%,0)",left:"50%",top:"50%"}),this.parentEl},u.prototype.cleanup=function(){for(var t=this.parentEl;t.firstChild;)t.removeChild(t.firstChild)},u.prototype.createMediaEl=function(){var t,e;this.mediaEl&&this.cleanup(),this.slideshow?(e="image",t=l("img")):(e="video",t=l("video",{height:1,width:1})),this.mediaEl=t,this.currMediaType=e,n(this.mediaEl,{display:"block"}),this.parentEl.appendChild(t)},u.prototype.init=function(t){t=t||{},("ontouchstart"in window||t.slideshow)&&(this.slideshow=!0),this._setParent(t.el),this.createMediaEl(),this._attachListeners()},u.prototype.show=function(t,e){return t.constructor===Array?this.showPlaylist([t],e):t.constructor===Object?this.showPlaylist([[t]],e):this.showPlaylist([r(t)],e)},u.prototype.showPlaylist=function(t,e){e.hasOwnProperty("mute")&&(this.mute=e.mute),e.hasOwnProperty("loop")&&(this.loop=e.loop);var i=a(t);this.poster=e.poster?e.poster:p(i),this._loadPlaylist(i)},u.prototype.setVolume=function(t){"image"!==this.currMediaType&&(0===t?(this.mute=!0,this.mediaEl.muted=!0,this.mediaEl.volume=0):(this.mute=!1,this.mediaEl.muted=!1,this.mediaEl.volume=t))},u.prototype.getMedia=function(){return this.mediaEl},u.prototype.getPlaylist=function(){return this.playlist},u.prototype.getItem=function(t){return this.playlist[t]},u.prototype.play=function(t){"number"==typeof t?this._playItem(this.playlist[t],t):"video"===this.currMediaType?this.mediaEl.play():this._slideshowTimer&&this._slideshowTimer.resume()},u.prototype.pause=function(){"video"===this.currMediaType?this.mediaEl.pause():this._slideshowTimer&&this._slideshowTimer.pause()},u.prototype.close=function(){this._removeAllListeners(),this.cleanup(),this._slideshowTimer&&(this._slideshowTimer.destroy(),delete this._slideshowTimer)},u.prototype.currentTime=function(){return"video"===this.currMediaType?this.mediaEl.currentTime:this._slideshowTimer.currentTime()},u.prototype.currentTime=function(){return"video"===this.currMediaType?this.mediaEl.currentTime:this._slideshowTimer.currentTime()},u.prototype.seekTo=function(t){this._seeking=!0,"video"===this.currMediaType&&(this.mediaEl.currentTime=t)},u.prototype.duration=function(){return"video"===this.currMediaType?this.mediaEl.duration:this.slideshowItemDuration},t.exports=u},function(t){"use strict";function e(){}e.prototype.on=function(t,e){return this._collection=this._collection||{},this._collection[t]=this._collection[t]||[],this._collection[t].push(e),this},e.prototype.once=function(t,e){function i(){s.off(t,i),e.apply(this,arguments)}var s=this;return i.listener=e,this.on(t,i),this},e.prototype.off=function(t,e){var i=this._collection[t],s=0;if(void 0!==i)for(s;s<i.length;s+=1)if(i[s]===e||i[s].listener===e){i.splice(s,1);break}return 0===i.length&&this.removeAllListeners(t),this},e.prototype.removeAllListeners=function(t){return this._collection=this._collection||{},delete this._collection[t],this},e.prototype.listeners=function(t){return this._collection=this._collection||{},this._collection[t]},e.prototype.emit=function(){if(void 0===this._collection)return this;var t,e=[].slice.call(arguments,0),i=e.shift(),s=this._collection[i],o=0;if(s)for(s=s.slice(0),t=s.length,o;t>o;o+=1)s[o].apply(this,e);return this},t.exports=e},function(t){t.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}}])});